{
  "version": 3,
  "sources": ["../../../worker.js"],
  "sourceRoot": "C:\\Users\\WON\\Desktop\\\uD504\uB85C\uC81D\uD2B8\\\uD3EC\uD2B8\uD3F4\uB9AC\uC624\\\uD3EC\uD2B8\uD3F4\uB9AC\uC624\\workers\\notion-blog-feed\\.wrangler\\tmp\\deploy-oHQQ2Y",
  "sourcesContent": ["/**\r\n * Cloudflare Worker: Notion Blog Feed API\r\n *\r\n * Notion \uB370\uC774\uD130\uBCA0\uC774\uC2A4\uC5D0\uC11C \uBE14\uB85C\uADF8 \uAC8C\uC2DC\uBB3C\uC744 \uAC00\uC838\uC640 JSON\uC73C\uB85C \uBC18\uD658\r\n *\r\n * \uD658\uACBD \uBCC0\uC218 (Workers Secrets):\r\n * - NOTION_API_KEY: Notion Integration Token\r\n * - NOTION_DATABASE_ID: \uBE14\uB85C\uADF8 \uB370\uC774\uD130\uBCA0\uC774\uC2A4 ID\r\n * - ALLOWED_ORIGINS: \uD5C8\uC6A9\uB41C Origin (\uC27C\uD45C\uB85C \uAD6C\uBD84, \uC608: \"https://example.com,https://www.example.com\")\r\n */\r\n\r\nconst NOTION_API_VERSION = '2022-06-28';\r\nconst NOTION_API_BASE = 'https://api.notion.com/v1';\r\n\r\n// CORS \uD5E4\uB354 \uC0DD\uC131\r\nfunction getCorsHeaders(request, env) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  const allowedOrigins = (env.ALLOWED_ORIGINS || 'http://localhost:5173,http://localhost:3000').split(',').map(o => o.trim());\r\n\r\n  const isAllowed = allowedOrigins.includes(origin) || allowedOrigins.includes('*');\r\n\r\n  return {\r\n    'Access-Control-Allow-Origin': isAllowed ? origin : allowedOrigins[0],\r\n    'Access-Control-Allow-Methods': 'GET, OPTIONS',\r\n    'Access-Control-Allow-Headers': 'Content-Type',\r\n    'Access-Control-Max-Age': '86400',\r\n  };\r\n}\r\n\r\n// Notion \uB9AC\uCE58 \uD14D\uC2A4\uD2B8\uB97C \uC77C\uBC18 \uD14D\uC2A4\uD2B8\uB85C \uBCC0\uD658\r\nfunction richTextToPlainText(richTextArray) {\r\n  if (!richTextArray || !Array.isArray(richTextArray)) return '';\r\n  return richTextArray.map(item => item.plain_text || '').join('');\r\n}\r\n\r\n// Notion \uD398\uC774\uC9C0\uB97C \uBE14\uB85C\uADF8 \uD3EC\uC2A4\uD2B8 \uD615\uC2DD\uC73C\uB85C \uBCC0\uD658\r\nfunction transformNotionPage(page) {\r\n  const properties = page.properties || {};\r\n\r\n  // \uC81C\uBAA9 \uCD94\uCD9C (Title \uD0C0\uC785 \uC18D\uC131 \uCC3E\uAE30)\r\n  let title = '';\r\n  for (const [key, prop] of Object.entries(properties)) {\r\n    if (prop.type === 'title') {\r\n      title = richTextToPlainText(prop.title);\r\n      break;\r\n    }\r\n  }\r\n\r\n  // \uC694\uC57D/\uC124\uBA85 \uCD94\uCD9C (\uD55C\uAE00 \uC18D\uC131\uBA85 \uC9C0\uC6D0)\r\n  const summary = properties.Summary?.rich_text\r\n    ? richTextToPlainText(properties.Summary.rich_text)\r\n    : properties['AI \uC790\uB3D9 \uC785\uB825']?.rich_text\r\n      ? richTextToPlainText(properties['AI \uC790\uB3D9 \uC785\uB825'].rich_text)\r\n      : properties.Description?.rich_text\r\n        ? richTextToPlainText(properties.Description.rich_text)\r\n        : '';\r\n\r\n  // \uB0A0\uC9DC \uCD94\uCD9C (\uD55C\uAE00 \uC18D\uC131\uBA85 \uC9C0\uC6D0)\r\n  let date = '';\r\n  if (properties['\uAC8C\uC2DC\uC77C']?.date?.start) {\r\n    date = properties['\uAC8C\uC2DC\uC77C'].date.start;\r\n  } else if (properties.Date?.date?.start) {\r\n    date = properties.Date.date.start;\r\n  } else if (properties.Created?.created_time) {\r\n    date = properties.Created.created_time.split('T')[0];\r\n  } else if (page.created_time) {\r\n    date = page.created_time.split('T')[0];\r\n  }\r\n\r\n  // \uD0DC\uADF8 \uCD94\uCD9C (\uD55C\uAE00 \uC18D\uC131\uBA85 \uC9C0\uC6D0)\r\n  const tags = [];\r\n  if (properties['\uD0DC\uADF8']?.multi_select) {\r\n    properties['\uD0DC\uADF8'].multi_select.forEach(tag => tags.push(tag.name));\r\n  } else if (properties.Tags?.multi_select) {\r\n    properties.Tags.multi_select.forEach(tag => tags.push(tag.name));\r\n  } else if (properties.Category?.select) {\r\n    tags.push(properties.Category.select.name);\r\n  }\r\n\r\n  // \uCEE4\uBC84 \uC774\uBBF8\uC9C0 \uCD94\uCD9C\r\n  let thumbnail = '';\r\n  if (page.cover) {\r\n    if (page.cover.type === 'external') {\r\n      thumbnail = page.cover.external.url;\r\n    } else if (page.cover.type === 'file') {\r\n      thumbnail = page.cover.file.url;\r\n    }\r\n  }\r\n\r\n  // \uC378\uB124\uC77C \uC18D\uC131\uC774 \uC788\uC73C\uBA74 \uC6B0\uC120 \uC0AC\uC6A9\r\n  if (properties.Thumbnail?.files?.[0]) {\r\n    const file = properties.Thumbnail.files[0];\r\n    thumbnail = file.external?.url || file.file?.url || thumbnail;\r\n  }\r\n\r\n  // URL \uCD94\uCD9C (\uC678\uBD80 \uB9C1\uD06C \uB610\uB294 Notion \uD398\uC774\uC9C0 URL)\r\n  let url = page.url || '';\r\n  if (properties.URL?.url) {\r\n    url = properties.URL.url;\r\n  } else if (properties.Link?.url) {\r\n    url = properties.Link.url;\r\n  }\r\n\r\n  // \uC791\uC131\uC790 \uCD94\uCD9C (\uD55C\uAE00 \uC18D\uC131\uBA85 \uC9C0\uC6D0)\r\n  let author = 'Won Kim';\r\n  if (properties['\uC0DD\uC131\uC790']?.people?.[0]?.name) {\r\n    author = properties['\uC0DD\uC131\uC790'].people[0].name;\r\n  } else if (properties.Author?.people?.[0]?.name) {\r\n    author = properties.Author.people[0].name;\r\n  } else if (properties.Author?.rich_text) {\r\n    author = richTextToPlainText(properties.Author.rich_text) || author;\r\n  }\r\n\r\n  // \uC0C1\uD0DC \uCD94\uCD9C (Published\uB9CC \uBC18\uD658\uD560\uC9C0 \uC5EC\uBD80)\r\n  const status = properties.Status?.select?.name || 'Published';\r\n\r\n  return {\r\n    id: page.id,\r\n    title: title || 'Untitled',\r\n    summary,\r\n    date,\r\n    tags,\r\n    thumbnail,\r\n    url,\r\n    author,\r\n    status,\r\n  };\r\n}\r\n\r\n// Notion \uB370\uC774\uD130\uBCA0\uC774\uC2A4 \uCFFC\uB9AC\r\nasync function queryNotionDatabase(env, limit = 10) {\r\n  const response = await fetch(`${NOTION_API_BASE}/databases/${env.NOTION_DATABASE_ID}/query`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Authorization': `Bearer ${env.NOTION_API_KEY}`,\r\n      'Notion-Version': NOTION_API_VERSION,\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify({\r\n      page_size: limit,\r\n      sorts: [\r\n        {\r\n          property: '\uAC8C\uC2DC\uC77C',\r\n          direction: 'descending',\r\n        },\r\n      ],\r\n    }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const errorText = await response.text();\r\n    throw new Error(`Notion API error: ${response.status} - ${errorText}`);\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n// \uBA54\uC778 \uD578\uB4E4\uB7EC\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    const corsHeaders = getCorsHeaders(request, env);\r\n\r\n    // Preflight \uC694\uCCAD \uCC98\uB9AC\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, {\r\n        status: 204,\r\n        headers: corsHeaders,\r\n      });\r\n    }\r\n\r\n    // GET \uC694\uCCAD\uB9CC \uD5C8\uC6A9\r\n    if (request.method !== 'GET') {\r\n      return new Response(JSON.stringify({ error: 'Method not allowed' }), {\r\n        status: 405,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          ...corsHeaders,\r\n        },\r\n      });\r\n    }\r\n\r\n    try {\r\n      // \uD658\uACBD \uBCC0\uC218 \uD655\uC778\r\n      if (!env.NOTION_API_KEY || !env.NOTION_DATABASE_ID) {\r\n        throw new Error('Missing required environment variables: NOTION_API_KEY or NOTION_DATABASE_ID');\r\n      }\r\n\r\n      // URL \uD30C\uB77C\uBBF8\uD130\uC5D0\uC11C limit \uCD94\uCD9C\r\n      const url = new URL(request.url);\r\n      const limit = Math.min(parseInt(url.searchParams.get('limit') || '10', 10), 50);\r\n\r\n      // Notion \uB370\uC774\uD130\uBCA0\uC774\uC2A4 \uCFFC\uB9AC\r\n      const notionResponse = await queryNotionDatabase(env, limit);\r\n\r\n      // \uACB0\uACFC \uBCC0\uD658\r\n      const posts = (notionResponse.results || []).map(transformNotionPage);\r\n\r\n      // \uC751\uB2F5 \uBC18\uD658\r\n      return new Response(JSON.stringify({\r\n        success: true,\r\n        posts,\r\n        total: posts.length,\r\n        hasMore: notionResponse.has_more || false,\r\n      }), {\r\n        status: 200,\r\n        headers: {\r\n          'Content-Type': 'application/json; charset=utf-8',\r\n          'Cache-Control': 'public, max-age=300', // 5\uBD84 \uCE90\uC2DC\r\n          ...corsHeaders,\r\n        },\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Error fetching Notion blog feed:', error);\r\n\r\n      return new Response(JSON.stringify({\r\n        success: false,\r\n        error: error.message || 'Failed to fetch blog posts',\r\n        posts: [],\r\n      }), {\r\n        status: 500,\r\n        headers: {\r\n          'Content-Type': 'application/json; charset=utf-8',\r\n          ...corsHeaders,\r\n        },\r\n      });\r\n    }\r\n  },\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
