(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const p=document.getElementById("game-board"),E=p.getContext("2d"),f=document.getElementById("next-piece"),D=f.getContext("2d"),ie=document.getElementById("score"),ae=document.getElementById("rows"),le=document.getElementById("level"),se=document.getElementById("high-score"),m=document.getElementById("game-overlay"),ce=document.getElementById("start-button"),h=document.getElementById("pause-button"),_=document.getElementById("restart-button");document.getElementById("game-area");const N=document.getElementById("game-board-container");document.getElementById("side-panel");const F=document.getElementById("next-piece-container"),w=10,P=20;let u=30;const de=[40,100,300,1200],M={I:{shape:[[1,1,1,1]],color:"#00f0f0",w:4,h:1},J:{shape:[[0,0,1],[1,1,1]],color:"#0000f0",w:3,h:2},L:{shape:[[1,0,0],[1,1,1]],color:"#f0a000",w:3,h:2},O:{shape:[[1,1],[1,1]],color:"#f0f000",w:2,h:2},S:{shape:[[0,1,1],[1,1,0]],color:"#00f000",w:3,h:2},T:{shape:[[0,1,0],[1,1,1]],color:"#a000f0",w:3,h:2},Z:{shape:[[1,1,0],[0,1,1]],color:"#f00000",w:3,h:2}},q="IJLOSTZ";let c=Q(),n={pos:{x:0,y:0},piece:O(),shape:[[]]},S=O(),g=0,I=0,y=0,B=parseInt(localStorage.getItem("tetrisHighScore")||"0"),l=!1,s=!0,A=0,R=1e3,v=0;function j(){const e=N.clientWidth,t=N.clientHeight;if(e===0||t===0)return;const r=Math.floor(e/w),i=Math.floor(t/P);u=Math.max(5,Math.min(r,i)),p.width=w*u,p.height=P*u;const o=window.getComputedStyle(F),a=parseFloat(o.paddingLeft)+parseFloat(o.paddingRight),d=F.clientWidth-a,b=Math.floor(d/4);f.width=4*b,f.height=4*b,ee(),(l||s)&&L()}function fe(){G(),j()}function Q(){return Array.from({length:P},()=>new Array(w).fill(0))}function O(){return q[Math.floor(Math.random()*q.length)]}function C(){n.piece=S,n.shape=M[n.piece].shape,n.pos.x=Math.floor((w-n.shape[0].length)/2),n.pos.y=0,S=O(),x()&&(s=!0,L())}function T(e=0){if(!s){if(!l){const t=e-v;v=e,A+=t,A>R&&H()}ee(),requestAnimationFrame(T)}}function H(){l||s||(n.pos.y++,x()&&(n.pos.y--,Y()),A=0)}function Y(){n.shape.forEach((e,t)=>{e.forEach((r,i)=>{r!==0&&(c[t+n.pos.y][i+n.pos.x]=n.piece)})}),ue()}function ue(){const e=[];e:for(let t=c.length-1;t>=0;t--){for(let r=0;r<c[t].length;r++)if(c[t][r]===0)continue e;e.push(t)}e.length>0?(l=!0,E.fillStyle="rgba(255, 255, 255, 0.7)",e.forEach(t=>{E.fillRect(0,t*u,p.width,u)}),setTimeout(()=>{e.forEach(r=>{c.splice(r,1)});const t=Array.from({length:e.length},()=>new Array(w).fill(0));c.unshift(...t),g+=de[e.length-1]*(y+1),I+=e.length,y=Math.floor(I/10),R=Math.max(200,1e3-y*80),G(),l=!1,v=performance.now(),C()},300)):C()}function x(){for(let e=0;e<n.shape.length;e++)for(let t=0;t<n.shape[e].length;t++)if(n.shape[e][t]!==0&&(c[e+n.pos.y]&&c[e+n.pos.y][t+n.pos.x])!==0)return!0;return!1}function k(e){l||s||(n.pos.x+=e,x()&&(n.pos.x-=e))}function $(){if(l||s)return;const e=n.shape,t=n.shape[0].map((i,o)=>n.shape.map(a=>a[o]).reverse());n.shape=t;let r=1;for(;x();)if(n.pos.x+=r,r=-(r+(r>0?1:-1)),r>n.shape[0].length){n.shape=e,n.pos.x-=r-1;return}}function z(){if(!(l||s)){for(;!x();)n.pos.y++;n.pos.y--,Y()}}function ee(){E.clearRect(0,0,p.width,p.height),he(),s||te(n.shape,n.pos,n.piece,E,u),pe()}function he(){c.forEach((e,t)=>{e.forEach((r,i)=>{r!==0&&ne(i,t,r,E,u)})})}function te(e,t,r,i,o){e.forEach((a,d)=>{a.forEach((b,re)=>{b!==0&&ne(re+t.x,d+t.y,r,i,o)})})}function ne(e,t,r,i,o){i.fillStyle=M[r].color,i.fillRect(e*o,t*o,o,o),i.strokeStyle="rgba(0, 0, 0, 0.2)",i.lineWidth=2,i.strokeRect(e*o,t*o,o,o)}function pe(){if(D.clearRect(0,0,f.width,f.height),f.width===0)return;const e=M[S],t=e.shape,r=f.width/4,i={x:(4-e.w)/2,y:(4-e.h)/2};te(t,i,S,D,r)}function G(){ie.textContent=g.toString(),ae.textContent=I.toString(),le.textContent=y.toString(),g>B&&(B=g,localStorage.setItem("tetrisHighScore",B.toString())),se.textContent=B.toString()}function L(){if(s){m.style.display="flex";const e='<div class="text-center"><p class="text-4xl sm:text-5xl">GAME OVER</p><button id="play-again" class="px-6 py-3 mt-4 bg-sky-500 hover:bg-sky-600 rounded-lg text-xl">Play Again</button></div>';m.innerHTML=e,document.getElementById("play-again").addEventListener("click",W)}else l?(m.style.display="flex",m.innerHTML='<div class="text-center text-4xl sm:text-5xl">PAUSED</div>'):m.style.display="none"}function W(){c=Q(),g=0,I=0,y=0,R=1e3,s=!1,l=!1,h.textContent="❚❚",h.setAttribute("aria-label","Pause Game"),C(),G(),L(),[h,_].forEach(e=>e.disabled=!1),T()}function oe(){s||(l=!l,L(),h.textContent=l?"▶":"❚❚",h.setAttribute("aria-label",l?"Resume Game":"Pause Game"),l||(v=performance.now(),T()))}function me(){W()}document.addEventListener("keydown",e=>{s||(e.key==="ArrowLeft"?k(-1):e.key==="ArrowRight"?k(1):e.key==="ArrowDown"?H():e.key==="ArrowUp"||e.key==="x"?$():e.key===" "?(e.preventDefault(),z()):e.key==="p"&&oe())});var U;(U=document.getElementById("left-button-mobile"))==null||U.addEventListener("click",()=>k(-1));var Z;(Z=document.getElementById("right-button-mobile"))==null||Z.addEventListener("click",()=>k(1));var K;(K=document.getElementById("down-button-mobile"))==null||K.addEventListener("click",()=>H());var V;(V=document.getElementById("rotate-button-mobile"))==null||V.addEventListener("click",()=>$());var X;(X=document.getElementById("hard-drop-button-mobile"))==null||X.addEventListener("click",()=>z());ce.addEventListener("click",W);h.addEventListener("click",oe);_.addEventListener("click",me);let J;window.addEventListener("resize",()=>{clearTimeout(J),J=setTimeout(j,100)});fe();
